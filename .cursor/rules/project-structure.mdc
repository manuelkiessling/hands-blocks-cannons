---
description: Monorepo project structure and organization
globs: ["**/*.ts", "**/*.tsx", "**/package.json"]
---

# Project Structure

This is an **npm workspaces monorepo** with a framework, apps, and a lobby.

## Node.js Version

This project requires **Node.js 24+**. Use your preferred version manager:

**Using mise (recommended):**
```bash
mise install        # Install Node version from .tool-versions
mise use            # Activate it
```

**Using nvm:**
```bash
nvm install 24      # If not already installed
nvm use             # Activate from .nvmrc
```

Both `.nvmrc` and `.tool-versions` files are provided for compatibility.

```
cam-gesture-experiment/
├── .nvmrc            # Node version (nvm)
├── .tool-versions    # Node version (mise)
├── packages/
│   ├── framework/
│   │   ├── protocol  # @gesture-app/framework-protocol (schemas/types)
│   │   ├── server    # @gesture-app/framework-server (SessionRuntime)
│   │   └── client    # @gesture-app/framework-client (SessionClient + config)
│   ├── applications/
│   │   ├── blocks-cannons  # Game app (server/client/bot)
│   │   └── hello-hands     # Demo app
│   └── lobby        # Lobby service (session creation, docker spawning)
└── package.json      # Workspace root
```

## Package Dependencies

```mermaid
graph TD
    Protocol["@gesture-app/framework-protocol"]
    Server["@gesture-app/framework-server"]
    Client["@gesture-app/framework-client"]
    App1["@gesture-app/blocks-cannons"]
    App2["@gesture-app/hello-hands"]
    Lobby["@gesture-app/lobby"]

    Server --> Protocol
    Client --> Protocol
    App1 --> Protocol
    App2 --> Protocol
    Lobby --> Protocol
```

## Key Commands

Run from workspace root (after `nvm use`):

```bash
# Full validation (build + typecheck + test)
npm run validate

# Development (per workspace)
npm run dev:server -w @gesture-app/blocks-cannons
npm run dev:client -w @gesture-app/blocks-cannons
npm run dev -w @gesture-app/lobby
```

## Adding Dependencies

Always specify the workspace when adding dependencies:

```bash
# Add to specific package
npm install <package> -w @gesture-app/framework-server
npm install <package> -w @gesture-app/framework-client
npm install <package> -w @gesture-app/framework-protocol
npm install <package> -w @gesture-app/blocks-cannons
npm install <package> -w @gesture-app/hello-hands
npm install <package> -w @gesture-app/lobby

# Add dev dependency
npm install -D <package> -w @gesture-app/framework-protocol
```

## Cross-Package Imports

Import across packages using workspace package names (no relative paths):
```typescript
import { createSessionServerMessageSchema } from '@gesture-app/framework-protocol';
import { SessionRuntime } from '@gesture-app/framework-server';
import { SessionClient } from '@gesture-app/framework-client';
import { BlocksWelcomeData } from '@gesture-app/blocks-cannons';
```

## Build Order

When building the full project:

1. `@gesture-app/framework-protocol` must build first
2. `@gesture-app/framework-server`, `@gesture-app/framework-client`, and applications can build afterward

The root `validate` script handles this automatically.

## Troubleshooting

If you encounter Node.js errors or missing features:

```bash
# Verify you're using the correct Node version
node --version   # Should show v24.x.x

# If not, activate the correct version
nvm use
```
