---
description: Game room dimensions and player positioning rules
globs: ["**/game/**/*.ts", "**/client/**/*.ts"]
---

# Game Room Dimensions & Positioning

## Room Coordinate System

The game uses a right-handed coordinate system:
- **X axis**: Left (-) to Right (+)
- **Y axis**: Down (-) to Up (+)
- **Z axis**: The axis along which players face each other

## Default Room Bounds (from config/game.yaml)

```
Room: 14 Ã— 10 Ã— 40 units
  X: -7 to +7 (width: 14)
  Y: -5 to +5 (height: 10)  
  Z: -8 to +32 (depth: 40)
```

## Player Positioning

Players are positioned on **opposite ends of the Z axis**, with blocks at the very edge:

### Player 1
- **Camera**: Outside room at `z = maxZ + cameraDistance` (positive Z, looking toward negative Z)
- **Hand & Blocks**: At room edge `z = maxZ - 0.5` (accounting for block half-size)
- **Fire direction**: Negative Z (toward opponent)
- **X-axis mirroring**: YES - left hand movement = left on screen

### Player 2
- **Camera**: Outside room at `z = minZ - cameraDistance` (negative Z, looking toward positive Z)
- **Hand & Blocks**: At room edge `z = minZ + 0.5` (accounting for block half-size)
- **Fire direction**: Positive Z (toward opponent)
- **X-axis mirroring**: NO - view is already flipped from opposite perspective

## Visual Representation

```
         Player 2 Camera
              â†“
    z = -20  [ğŸ“·]
              |
    z = -8   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† Room boundary (minZ)
    z â‰ˆ-7.5  â”‚âœ‹ [P2 blocks]   â”‚  â† Player 2's hand & blocks (at edge)
              â”‚                 â”‚
              â”‚       â—â†’â†’â†’      â”‚  â† P2 projectiles travel +Z
              â”‚                 â”‚
    z â‰ˆ+31.5 â”‚âœ‹ [P1 blocks]   â”‚  â† Player 1's hand & blocks (at edge)
    z = +32  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â† Room boundary (maxZ)
              |
    z = +44  [ğŸ“·]
              â†‘
         Player 1 Camera
```

## Key Rules

1. **Blocks spawn at the room edge on the player's side**
   - "My" blocks are right in front of me (no Z distance from screen)
   - "Opponent's" blocks are at the far end of the room

2. **Hand position matches block Z position**
   - Hand and blocks are at the same Z depth
   - Spread across X/Y only, fixed Z at room edge

3. **X-axis mapping depends on viewing direction**
   - Player looking from +Z: mirror X (webcam is mirrored, so un-mirror for natural feel)
   - Player looking from -Z: don't mirror (opposite view already flips X)

4. **Block positions are clamped to room bounds**
   - Account for block half-size (0.5 units) to prevent blocks from clipping through walls
   - Clamped position: `min + 0.5` to `max - 0.5` for each axis

5. **Projectiles travel along Z axis only**
   - Player 1 fires toward -Z
   - Player 2 fires toward +Z
   - Destroyed when exiting room bounds

## Code References

**Server (packages/server):**
- Room bounds: `src/game/types.ts` â†’ `DEFAULT_ROOM`
- Block spawn Z: `src/game/types.ts` â†’ `getPlayerSpawnZ()`
- Position clamping: `src/game/types.ts` â†’ `clampToRoom()`
- Fire direction: `src/game/CannonSystem.ts` â†’ `getFireDirection()`

**Client (packages/client):**
- Camera setup: `src/scene/SceneManager.ts` â†’ `setupCameraForPlayer()`
- Hand mapping: `src/input/GestureDetector.ts` â†’ `landmarkTo3D()`
- Block rendering: `src/scene/BlockRenderer.ts`

**Shared (packages/shared):**
- Type definitions: `src/types/index.ts` â†’ `Position`, `RoomBounds`
- Constants: `src/constants.ts` â†’ `CAMERA_MARGIN`
