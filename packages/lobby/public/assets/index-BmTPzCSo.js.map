{"version":3,"file":"index-BmTPzCSo.js","sources":["../../frontend/main.ts"],"sourcesContent":["/**\n * Lobby frontend application.\n */\n\ninterface CreateSessionResponse {\n  sessionId: string;\n  gameUrl: string;\n  joinUrl: string | null;\n}\n\n// Screen management\nconst screens = {\n  start: document.getElementById('start-screen'),\n  botSettings: document.getElementById('bot-settings'),\n  loading: document.getElementById('loading-screen'),\n  gameReady: document.getElementById('game-ready'),\n  error: document.getElementById('error-screen'),\n} as const;\n\nfunction showScreen(screenId: keyof typeof screens): void {\n  for (const [id, element] of Object.entries(screens)) {\n    if (element) {\n      element.classList.toggle('active', id === screenId);\n    }\n  }\n}\n\n// State\nlet currentSession: CreateSessionResponse | null = null;\n\n// Elements\nconst playBotBtn = document.getElementById('play-bot');\nconst playHumanBtn = document.getElementById('play-human');\nconst backFromBotBtn = document.getElementById('back-from-bot');\nconst startBotGameBtn = document.getElementById('start-bot-game');\nconst difficultySlider = document.getElementById('difficulty') as HTMLInputElement | null;\nconst loadingText = document.getElementById('loading-text');\nconst shareSection = document.getElementById('share-section');\nconst shareUrlInput = document.getElementById('share-url') as HTMLInputElement | null;\nconst copyUrlBtn = document.getElementById('copy-url');\nconst cancelGameBtn = document.getElementById('cancel-game');\nconst joinGameBtn = document.getElementById('join-game');\nconst errorMessage = document.getElementById('error-message');\nconst tryAgainBtn = document.getElementById('try-again');\n\n// API functions\nasync function createSession(\n  opponentType: 'bot' | 'human',\n  botDifficulty?: number\n): Promise<CreateSessionResponse> {\n  const response = await fetch('/api/sessions', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ opponentType, botDifficulty }),\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || 'Failed to create session');\n  }\n\n  return response.json();\n}\n\nasync function deleteSession(sessionId: string): Promise<void> {\n  await fetch(`/api/sessions/${sessionId}`, { method: 'DELETE' });\n}\n\n// Event handlers\nfunction handlePlayBot(): void {\n  showScreen('botSettings');\n}\n\nfunction handlePlayHuman(): void {\n  startGame('human');\n}\n\nfunction handleBackFromBot(): void {\n  showScreen('start');\n}\n\nfunction handleStartBotGame(): void {\n  const difficulty = difficultySlider ? Number(difficultySlider.value) / 100 : 0.5;\n  startGame('bot', difficulty);\n}\n\n// Countdown duration in seconds before Join button is enabled\nconst CONTAINER_READY_DELAY_SECONDS = 4;\n\nasync function startGame(opponentType: 'bot' | 'human', botDifficulty?: number): Promise<void> {\n  showScreen('loading');\n  if (loadingText) {\n    loadingText.textContent = 'Creating game session...';\n  }\n\n  try {\n    currentSession = await createSession(opponentType, botDifficulty);\n\n    // Show game ready screen\n    showScreen('gameReady');\n\n    // Show share section for human games\n    if (shareSection && shareUrlInput) {\n      if (opponentType === 'human' && currentSession.joinUrl) {\n        shareSection.classList.remove('hidden');\n        shareUrlInput.value = currentSession.joinUrl;\n      } else {\n        shareSection.classList.add('hidden');\n      }\n    }\n\n    // Disable Join button and show countdown while container starts\n    startJoinCountdown();\n  } catch (err) {\n    showError(err instanceof Error ? err.message : 'An unexpected error occurred');\n  }\n}\n\nfunction startJoinCountdown(): void {\n  if (!joinGameBtn) return;\n\n  // Disable button and start countdown\n  joinGameBtn.setAttribute('disabled', 'true');\n  let secondsLeft = CONTAINER_READY_DELAY_SECONDS;\n\n  const updateButtonText = (): void => {\n    if (joinGameBtn) {\n      joinGameBtn.textContent = `Preparing... ${secondsLeft}s`;\n    }\n  };\n\n  updateButtonText();\n\n  const countdownInterval = setInterval(() => {\n    secondsLeft--;\n    if (secondsLeft <= 0) {\n      clearInterval(countdownInterval);\n      if (joinGameBtn) {\n        joinGameBtn.removeAttribute('disabled');\n        joinGameBtn.textContent = 'Join Game';\n      }\n    } else {\n      updateButtonText();\n    }\n  }, 1000);\n}\n\nfunction handleCopyUrl(): void {\n  if (shareUrlInput) {\n    navigator.clipboard.writeText(shareUrlInput.value).then(() => {\n      const originalText = copyUrlBtn?.textContent;\n      if (copyUrlBtn) {\n        copyUrlBtn.textContent = 'âœ“';\n        setTimeout(() => {\n          copyUrlBtn.textContent = originalText ?? 'ðŸ“‹';\n        }, 2000);\n      }\n    });\n  }\n}\n\nasync function handleCancelGame(): Promise<void> {\n  if (currentSession) {\n    try {\n      await deleteSession(currentSession.sessionId);\n    } catch {\n      // Ignore errors when canceling\n    }\n    currentSession = null;\n  }\n  showScreen('start');\n}\n\nfunction handleJoinGame(): void {\n  if (currentSession) {\n    window.location.href = currentSession.gameUrl;\n  }\n}\n\nfunction showError(message: string): void {\n  if (errorMessage) {\n    errorMessage.textContent = message;\n  }\n  showScreen('error');\n}\n\nfunction handleTryAgain(): void {\n  currentSession = null;\n  showScreen('start');\n}\n\n// Attach event listeners\nplayBotBtn?.addEventListener('click', handlePlayBot);\nplayHumanBtn?.addEventListener('click', handlePlayHuman);\nbackFromBotBtn?.addEventListener('click', handleBackFromBot);\nstartBotGameBtn?.addEventListener('click', handleStartBotGame);\ncopyUrlBtn?.addEventListener('click', handleCopyUrl);\ncancelGameBtn?.addEventListener('click', handleCancelGame);\njoinGameBtn?.addEventListener('click', handleJoinGame);\ntryAgainBtn?.addEventListener('click', handleTryAgain);\n\n// Initialize\nshowScreen('start');\n"],"names":["screens","showScreen","screenId","id","element","currentSession","playBotBtn","playHumanBtn","backFromBotBtn","startBotGameBtn","difficultySlider","loadingText","shareSection","shareUrlInput","copyUrlBtn","cancelGameBtn","joinGameBtn","errorMessage","tryAgainBtn","createSession","opponentType","botDifficulty","response","error","deleteSession","sessionId","handlePlayBot","handlePlayHuman","startGame","handleBackFromBot","handleStartBotGame","difficulty","CONTAINER_READY_DELAY_SECONDS","startJoinCountdown","err","showError","secondsLeft","updateButtonText","countdownInterval","handleCopyUrl","originalText","handleCancelGame","handleJoinGame","message","handleTryAgain"],"mappings":"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"}