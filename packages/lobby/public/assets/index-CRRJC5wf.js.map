{"version":3,"file":"index-CRRJC5wf.js","sources":["../../frontend/main.ts"],"sourcesContent":["/**\n * Lobby frontend application.\n * Allows users to select an application and start a session.\n */\n\n/** Application manifest from the registry */\ninterface AppManifest {\n  id: string;\n  name: string;\n  version: string;\n  description?: string;\n  tags?: readonly string[];\n  supportsBot?: boolean;\n}\n\n/** Response from fetching available apps */\ninterface AppsResponse {\n  apps: AppManifest[];\n}\n\n/** Response from creating a session */\ninterface CreateSessionResponse {\n  sessionId: string;\n  appId: string;\n  sessionUrl: string;\n  joinUrl: string | null;\n}\n\n// Screen management\nconst screens = {\n  appSelect: document.getElementById('app-select-screen'),\n  start: document.getElementById('start-screen'),\n  botSettings: document.getElementById('bot-settings'),\n  loading: document.getElementById('loading-screen'),\n  sessionReady: document.getElementById('session-ready'),\n  error: document.getElementById('error-screen'),\n} as const;\n\nfunction showScreen(screenId: keyof typeof screens): void {\n  for (const [id, element] of Object.entries(screens)) {\n    if (element) {\n      element.classList.toggle('active', id === screenId);\n    }\n  }\n}\n\n// State\nlet availableApps: AppManifest[] = [];\nlet selectedApp: AppManifest | null = null;\nlet currentSession: CreateSessionResponse | null = null;\n\n// Elements\nconst appGrid = document.getElementById('app-grid');\nconst selectedAppName = document.getElementById('selected-app-name');\nconst backToAppsBtn = document.getElementById('back-to-apps');\nconst playBotBtn = document.getElementById('play-bot');\nconst playHumanBtn = document.getElementById('play-human');\nconst backFromBotBtn = document.getElementById('back-from-bot');\nconst startBotSessionBtn = document.getElementById('start-bot-session');\nconst difficultySlider = document.getElementById('difficulty') as HTMLInputElement | null;\nconst loadingText = document.getElementById('loading-text');\nconst shareSection = document.getElementById('share-section');\nconst shareUrlInput = document.getElementById('share-url') as HTMLInputElement | null;\nconst copyUrlBtn = document.getElementById('copy-url');\nconst cancelSessionBtn = document.getElementById('cancel-session');\nconst joinSessionBtn = document.getElementById('join-session');\nconst errorMessage = document.getElementById('error-message');\nconst tryAgainBtn = document.getElementById('try-again');\n\n// API functions\nasync function fetchApps(): Promise<AppManifest[]> {\n  const response = await fetch('/api/sessions/apps');\n  if (!response.ok) {\n    throw new Error('Failed to fetch applications');\n  }\n  const data: AppsResponse = await response.json();\n  return data.apps;\n}\n\nasync function createSession(\n  appId: string,\n  opponentType: 'bot' | 'human',\n  botDifficulty?: number\n): Promise<CreateSessionResponse> {\n  const response = await fetch('/api/sessions', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ appId, opponentType, botDifficulty }),\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || 'Failed to create session');\n  }\n\n  return response.json();\n}\n\nasync function deleteSession(sessionId: string): Promise<void> {\n  await fetch(`/api/sessions/${sessionId}`, { method: 'DELETE' });\n}\n\n// Render functions\nfunction renderAppCards(apps: AppManifest[]): void {\n  if (!appGrid) return;\n\n  if (apps.length === 0) {\n    appGrid.innerHTML = `\n      <div class=\"no-apps\">\n        <p>No applications available</p>\n      </div>\n    `;\n    return;\n  }\n\n  appGrid.innerHTML = apps\n    .map(\n      (app) => `\n      <button class=\"app-card\" data-app-id=\"${app.id}\">\n        <span class=\"app-name\">${app.name}</span>\n        ${app.description ? `<span class=\"app-desc\">${app.description}</span>` : ''}\n        ${\n          app.tags && app.tags.length > 0\n            ? `<div class=\"app-tags\">${app.tags.map((tag) => `<span class=\"tag\">${tag}</span>`).join('')}</div>`\n            : ''\n        }\n      </button>\n    `\n    )\n    .join('');\n\n  // Add click listeners to app cards\n  for (const card of appGrid.querySelectorAll('.app-card')) {\n    card.addEventListener('click', () => {\n      const appId = card.getAttribute('data-app-id');\n      const app = apps.find((a) => a.id === appId);\n      if (app) {\n        handleSelectApp(app);\n      }\n    });\n  }\n}\n\n// Event handlers\nfunction handleSelectApp(app: AppManifest): void {\n  selectedApp = app;\n  if (selectedAppName) {\n    selectedAppName.textContent = app.name;\n  }\n  // Show/hide bot button based on app support\n  if (playBotBtn) {\n    if (app.supportsBot) {\n      playBotBtn.classList.remove('hidden');\n    } else {\n      playBotBtn.classList.add('hidden');\n    }\n  }\n  showScreen('start');\n}\n\nfunction handleBackToApps(): void {\n  selectedApp = null;\n  showScreen('appSelect');\n}\n\nfunction handlePlayBot(): void {\n  showScreen('botSettings');\n}\n\nfunction handlePlayHuman(): void {\n  startSession('human');\n}\n\nfunction handleBackFromBot(): void {\n  showScreen('start');\n}\n\nfunction handleStartBotSession(): void {\n  const difficulty = difficultySlider ? Number(difficultySlider.value) / 100 : 0.5;\n  startSession('bot', difficulty);\n}\n\n// Countdown duration in seconds before Join button is enabled\nconst CONTAINER_READY_DELAY_SECONDS = 4;\n\nasync function startSession(opponentType: 'bot' | 'human', botDifficulty?: number): Promise<void> {\n  if (!selectedApp) {\n    showError('No application selected');\n    return;\n  }\n\n  showScreen('loading');\n  if (loadingText) {\n    loadingText.textContent = 'Creating session...';\n  }\n\n  try {\n    currentSession = await createSession(selectedApp.id, opponentType, botDifficulty);\n\n    // Show session ready screen\n    showScreen('sessionReady');\n\n    // Show share section for human sessions\n    if (shareSection && shareUrlInput) {\n      if (opponentType === 'human' && currentSession.joinUrl) {\n        shareSection.classList.remove('hidden');\n        shareUrlInput.value = currentSession.joinUrl;\n      } else {\n        shareSection.classList.add('hidden');\n      }\n    }\n\n    // Disable Join button and show countdown while container starts\n    startJoinCountdown();\n  } catch (err) {\n    showError(err instanceof Error ? err.message : 'An unexpected error occurred');\n  }\n}\n\nfunction startJoinCountdown(): void {\n  if (!joinSessionBtn) return;\n\n  // Disable button and start countdown\n  joinSessionBtn.setAttribute('disabled', 'true');\n  let secondsLeft = CONTAINER_READY_DELAY_SECONDS;\n\n  const updateButtonText = (): void => {\n    if (joinSessionBtn) {\n      joinSessionBtn.textContent = `Preparing... ${secondsLeft}s`;\n    }\n  };\n\n  updateButtonText();\n\n  const countdownInterval = setInterval(() => {\n    secondsLeft--;\n    if (secondsLeft <= 0) {\n      clearInterval(countdownInterval);\n      if (joinSessionBtn) {\n        joinSessionBtn.removeAttribute('disabled');\n        joinSessionBtn.textContent = 'Join';\n      }\n    } else {\n      updateButtonText();\n    }\n  }, 1000);\n}\n\nfunction handleCopyUrl(): void {\n  if (shareUrlInput) {\n    navigator.clipboard.writeText(shareUrlInput.value).then(() => {\n      const originalText = copyUrlBtn?.textContent;\n      if (copyUrlBtn) {\n        copyUrlBtn.textContent = '‚úì';\n        setTimeout(() => {\n          copyUrlBtn.textContent = originalText ?? 'üìã';\n        }, 2000);\n      }\n    });\n  }\n}\n\nasync function handleCancelSession(): Promise<void> {\n  if (currentSession) {\n    try {\n      await deleteSession(currentSession.sessionId);\n    } catch {\n      // Ignore errors when canceling\n    }\n    currentSession = null;\n  }\n  showScreen('start');\n}\n\nfunction handleJoinSession(): void {\n  if (currentSession) {\n    window.location.href = currentSession.sessionUrl;\n  }\n}\n\nfunction showError(message: string): void {\n  if (errorMessage) {\n    errorMessage.textContent = message;\n  }\n  showScreen('error');\n}\n\nfunction handleTryAgain(): void {\n  currentSession = null;\n  if (selectedApp) {\n    showScreen('start');\n  } else {\n    showScreen('appSelect');\n  }\n}\n\n// Attach event listeners\nbackToAppsBtn?.addEventListener('click', handleBackToApps);\nplayBotBtn?.addEventListener('click', handlePlayBot);\nplayHumanBtn?.addEventListener('click', handlePlayHuman);\nbackFromBotBtn?.addEventListener('click', handleBackFromBot);\nstartBotSessionBtn?.addEventListener('click', handleStartBotSession);\ncopyUrlBtn?.addEventListener('click', handleCopyUrl);\ncancelSessionBtn?.addEventListener('click', handleCancelSession);\njoinSessionBtn?.addEventListener('click', handleJoinSession);\ntryAgainBtn?.addEventListener('click', handleTryAgain);\n\n// Initialize\nasync function init(): Promise<void> {\n  showScreen('appSelect');\n\n  try {\n    availableApps = await fetchApps();\n    renderAppCards(availableApps);\n  } catch {\n    if (appGrid) {\n      appGrid.innerHTML = `\n        <div class=\"error-content\">\n          <span class=\"error-icon\">‚ö†Ô∏è</span>\n          <p>Failed to load applications</p>\n          <button class=\"btn primary\" onclick=\"location.reload()\">Retry</button>\n        </div>\n      `;\n    }\n  }\n}\n\ninit();\n"],"names":["screens","showScreen","screenId","id","element","availableApps","selectedApp","currentSession","appGrid","selectedAppName","backToAppsBtn","playBotBtn","playHumanBtn","backFromBotBtn","startBotSessionBtn","difficultySlider","loadingText","shareSection","shareUrlInput","copyUrlBtn","cancelSessionBtn","joinSessionBtn","errorMessage","tryAgainBtn","fetchApps","response","createSession","appId","opponentType","botDifficulty","error","deleteSession","sessionId","renderAppCards","apps","app","tag","card","a","handleSelectApp","handleBackToApps","handlePlayBot","handlePlayHuman","startSession","handleBackFromBot","handleStartBotSession","difficulty","CONTAINER_READY_DELAY_SECONDS","showError","startJoinCountdown","err","secondsLeft","updateButtonText","countdownInterval","handleCopyUrl","originalText","handleCancelSession","handleJoinSession","message","handleTryAgain","init"],"mappings":"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"}